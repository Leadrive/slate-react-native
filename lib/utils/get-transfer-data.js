'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[typeof Symbol==='function'?Symbol.iterator:'@@iterator'](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if((typeof Symbol==='function'?Symbol.iterator:'@@iterator')in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _slateBase64Serializer=require('slate-base64-serializer');var _slateBase64Serializer2=_interopRequireDefault(_slateBase64Serializer);var _transferTypes=require('../constants/transfer-types');var _transferTypes2=_interopRequireDefault(_transferTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var FRAGMENT_MATCHER=/ data-slate-fragment="([^\s"]+)"/;function getTransferData(transfer){var fragment=getType(transfer,_transferTypes2.default.FRAGMENT);var node=getType(transfer,_transferTypes2.default.NODE);var html=getType(transfer,'text/html');var rich=getType(transfer,'text/rtf');var text=getType(transfer,'text/plain');var files=void 0;if(!fragment&&html&&~html.indexOf(' data-slate-fragment="')){var matches=FRAGMENT_MATCHER.exec(html);var _matches=_slicedToArray(matches,2),full=_matches[0],encoded=_matches[1];if(encoded)fragment=encoded;}var embeddedTypes=getEmbeddedTypes(text);if(embeddedTypes[_transferTypes2.default.FRAGMENT])fragment=embeddedTypes[_transferTypes2.default.FRAGMENT];if(embeddedTypes[_transferTypes2.default.NODE])node=embeddedTypes[_transferTypes2.default.NODE];if(embeddedTypes['text/plain'])text=embeddedTypes['text/plain'];if(fragment)fragment=_slateBase64Serializer2.default.deserializeNode(fragment);if(node)node=_slateBase64Serializer2.default.deserializeNode(node);if(transfer.items&&transfer.items.length){files=Array.from(transfer.items).map(function(item){return item.kind=='file'?item.getAsFile():null;}).filter(function(exists){return exists;});}else if(transfer.files&&transfer.files.length){files=Array.from(transfer.files);}var data={files:files,fragment:fragment,html:html,node:node,rich:rich,text:text};data.type=getTransferType(data);return data;}function getEmbeddedTypes(text){var prefix='SLATE-DATA-EMBED::';if(text.substring(0,prefix.length)!==prefix){return{'text/plain':text};}try{return JSON.parse(text.substring(prefix.length));}catch(err){throw new Error('Unable to parse custom embedded drag data');}}function getTransferType(data){if(data.fragment)return'fragment';if(data.node)return'node';if(data.rich&&data.html)return'html';if(data.rich&&data.text)return'text';if(data.files&&data.files.length)return'files';if(data.html)return'html';if(data.text)return'text';return'unknown';}function getType(transfer,type){if(!transfer.types||!transfer.types.length){return type==='text/plain'?transfer.getData('Text')||null:null;}return transfer.types.indexOf(type)!==-1?transfer.getData(type)||null:null;}exports.default=getTransferData;